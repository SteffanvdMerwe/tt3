name: Deploy TurboRepo to Azure App Service

on:
  push:
    branches:
      - main  # Trigger the workflow when code is pushed to the `main` branch

jobs:
  deploy:
    runs-on: ubuntu-latest  # Specify the runner (Ubuntu in this case)

    steps:
    - name: Checkout code
      uses: actions/checkout@v2  # Check out the code from the GitHub repository

    - name: Set up Node.js
      uses: actions/setup-node@v3  # Set up Node.js environment
      with:
        node-version: '20.x'  # Specify the version of Node.js for your app

    - name: Install TurboRepo dependencies
      run: |
        npm clean-install
        npm install -g turbo  # Install Turbo globally
        turbo install          # Install all dependencies in the TurboRepo monorepo

    - name: Build Next.js app
      run: |
        npm run build     # Build the Next.js app (replace with your specific build script)
    
    - name: Deploy to Azure
      uses: azure/webapps-deploy@v2  # Use Azure App Service Deploy action
      with:
        app-name: turbo-test  # Replace with your Azure App Service name
        slot-name: 'production'          # Deployment slot (you can use 'production' or a custom slot)
        publish-profile: ${{ secrets.AZURE_WEBAPP_PUBLISH_PROFILE }}  # Publish profile from GitHub Secrets
